---
apiVersion: "cilium.io/v2"
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: "allow-essential-node-traffic"
spec:
  description: "Baseline node policy needed for essential cluster functionality"
  nodeSelector:
    matchLabels: {}
  egress:
    - toCIDR:
      - '{{ cilium_bgp_peer_address + "/32"}}'
      toPorts:
      - ports:
        - port: '179'
          protocol: TCP
      - ports:
        - port: '53'
    - icmps:
      - fields:
        - type: EchoRequest
          family: IPv4
    - toEntities:
      - health
  ingress:
  - icmps:
    - fields:
      - type: EchoRequest
        family: IPv4
  - fromEntities:
    - remote-node
    - health
    toPorts:
      - ports:
        - port: "22"
          protocol: TCP
        - port: "6443"
          protocol: TCP
        - port: "2379"
          protocol: TCP
        - port: "4240"
          protocol: TCP
        - port: "8472"
          protocol: UDP